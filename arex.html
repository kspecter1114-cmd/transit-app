<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공항철도 정보</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">← 뒤로</a>
        <h1>🚄 공항철도</h1>
        
        <!-- 출퇴근 시작역 실시간 정보 -->
        <div class="time-table">
            <h3>🚇 출퇴근 지하철 실시간 정보</h3>
            
            <div class="direction-section">
                <h4>🌅 청라국제도시역 (출근시) - 공항철도</h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">서울행</p>
                <div id="cheongna-info">
                    <div class="loading">정보를 불러오는 중...</div>
                </div>
                <p id="cheongna-update" style="font-size: 11px; color: #999; text-align: right; margin-top: 5px;"></p>
            </div>
            
            <div class="direction-section">
                <h4>🌆 동대문역사문화공원역 (퇴근시) - 4호선 하행</h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">오이도행, 사당행</p>
                <div id="dongdaemun-info">
                    <div class="loading">정보를 불러오는 중...</div>
                </div>
                <p id="dongdaemun-update" style="font-size: 11px; color: #999; text-align: right; margin-top: 5px;"></p>
            </div>
            
            <button class="refresh-btn" onclick="getStationInfo()">새로고침</button>
        </div>
        
        <!-- 서울역 공항철도 시간표 -->
        <div class="time-table">
            <h3>🚉 서울역 공항철도 시간표</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">현재 시간: <span id="current-time"></span></p>
            
            <div class="direction-section">
                <h4>🛫 서울역 출발 → 인천공항2터미널 (일반열차)</h4>
                <div id="seoul-departure-schedule">
                    <!-- 현재 시간 이후 시간표가 JavaScript로 동적 생성됩니다 -->
                </div>
                <p style="font-size: 11px; color: #999; text-align: center; margin-top: 10px;">
                    소요시간: 약 56분 | 20분 간격 운행<br>
                    공항철도 공식 시간표 기준
                </p>
            </div>
        </div>
    </div>
    
    <script>
        // 현재 시간 업데이트
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-time').textContent = timeString;
        }
        
        // 현재 시간 이후 공항철도 시간표 생성 (공식 시간표 기준)
        function generateArexSchedule() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // 공항철도 공식 시간표 (서울역 → 인천공항2터미널 일반열차)
            const officialSchedule = [
                '05:23', '05:53', '06:13', '06:33', '06:53', '07:13', '07:33', '07:53',
                '08:13', '08:33', '08:53', '09:13', '09:33', '09:53', '10:13', '10:33',
                '10:53', '11:13', '11:33', '11:53', '12:13', '12:33', '12:53', '13:13',
                '13:33', '13:53', '14:13', '14:33', '14:53', '15:13', '15:33', '15:53',
                '16:13', '16:33', '16:53', '17:13', '17:33', '17:53', '18:13', '18:33',
                '18:53', '19:13', '19:33', '19:53', '20:13', '20:33', '20:53', '21:13',
                '21:33', '21:53', '22:13', '22:33', '22:53', '23:13', '23:33', '23:53'
            ];
            
            // 현재 시간 이후 시간표만 필터링
            const futureSchedule = officialSchedule.filter(timeStr => {
                const [hour, minute] = timeStr.split(':').map(Number);
                return hour > currentHour || (hour === currentHour && minute > currentMinute);
            }).slice(0, 10); // 다음 10개만 표시
            
            const scheduleDiv = document.getElementById('seoul-departure-schedule');
            let html = '';
            
            futureSchedule.forEach(timeStr => {
                const [hour, minute] = timeStr.split(':').map(Number);
                const departureTime = new Date();
                departureTime.setHours(hour, minute, 0, 0);
                
                const timeDiff = Math.floor((departureTime - now) / (1000 * 60));
                const remainingText = timeDiff <= 0 ? '곧 출발' : `${timeDiff}분 후`;
                
                html += `
                    <div class="time-item">
                        <span><strong>${timeStr}</strong> → 인천공항2터미널</span>
                        <span class="arrival-time">${remainingText}</span>
                    </div>
                `;
            });
            
            if (futureSchedule.length === 0) {
                html = '<div class="error">오늘 운행이 종료되었습니다.</div>';
            }
            
            scheduleDiv.innerHTML = html;
        }
        
        // 공항철도 시간표 생성 (행선지 포함)
        function generateSchedule(direction) {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            let schedules = [];
            
            // 6시부터 23시까지 운행
            for (let hour = Math.max(6, currentHour); hour <= 23; hour++) {
                const intervals = [5, 15, 25, 35, 45, 55];
                
                intervals.forEach(minute => {
                    if (hour === currentHour && minute <= currentMinute) {
                        return;
                    }
                    
                    const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const remainingMinutes = (hour - currentHour) * 60 + (minute - currentMinute);
                    
                    if (schedules.length < 6) {
                        // 행선지 랜덤 선택
                        const destinations = direction === 'airport' 
                            ? ['검암', '인천공항'] 
                            : ['서울역', '청라국제도시'];
                        const destination = destinations[Math.floor(Math.random() * destinations.length)];
                        
                        schedules.push({
                            time: timeStr,
                            remaining: remainingMinutes > 0 ? `${remainingMinutes}분 후` : '곧 출발',
                            destination: destination
                        });
                    }
                });
            }
            
            return schedules;
        }
        
        // 출퇴근 시작역 실시간 정보
        async function getStationInfo() {
            const cheongnaDiv = document.getElementById('cheongna-info');
            const dongdaemunDiv = document.getElementById('dongdaemun-info');
            const cheongnaUpdateDiv = document.getElementById('cheongna-update');
            const dongdaemunUpdateDiv = document.getElementById('dongdaemun-update');
            
            // 첫 로딩이 아닌 경우 기존 데이터 유지
            if (cheongnaDiv.innerHTML.includes('loading')) {
                cheongnaDiv.innerHTML = '<div class="loading">정보를 불러오는 중...</div>';
            }
            if (dongdaemunDiv.innerHTML.includes('loading')) {
                dongdaemunDiv.innerHTML = '<div class="loading">정보를 불러오는 중...</div>';
            }
            
            const currentTime = new Date().toLocaleTimeString();
            
            // 청라국제도시역 실제 지하철 정보 (서울행만)
            try {
                const cheongnaResponse = await fetch('/api/subway?station=청라국제도시');
                const cheongnaResult = await cheongnaResponse.json();
                
                console.log('청라국제도시역 API 응답:', cheongnaResult);
                
                if (cheongnaResult.success && cheongnaResult.trains && cheongnaResult.trains.length > 0) {
                    let cheongnaHtml = '';
                    cheongnaResult.trains.forEach(train => {
                        const arrivalInfo = train.status || `${train.arrivalTime}초 후`;
                        cheongnaHtml += `
                            <div class="time-item">
                                <span><strong>공항철도</strong> → ${train.destination}</span>
                                <span class="arrival-time">${arrivalInfo}</span>
                            </div>
                        `;
                    });
                    cheongnaDiv.innerHTML = cheongnaHtml;
                } else {
                    cheongnaDiv.innerHTML = '<div class="error">서울행 열차 정보가 없습니다.</div>';
                }
                
                cheongnaUpdateDiv.textContent = `마지막 업데이트: ${currentTime}`;
                
            } catch (error) {
                console.error('청라국제도시역 API 오류:', error);
                if (cheongnaDiv.innerHTML.includes('loading')) {
                    cheongnaDiv.innerHTML = '<div class="error">지하철 정보를 불러올 수 없습니다.</div>';
                }
            }
            
            // 동대문역사문화공원역 실제 지하철 정보 (4호선 하행선만)
            try {
                const dongdaemunResponse = await fetch('/api/subway?station=동대문역사문화공원');
                const dongdaemunResult = await dongdaemunResponse.json();
                
                console.log('동대문역사문화공원역 API 응답:', dongdaemunResult);
                
                if (dongdaemunResult.success && dongdaemunResult.trains && dongdaemunResult.trains.length > 0) {
                    let dongdaemunHtml = '';
                    dongdaemunResult.trains.forEach(train => {
                        const arrivalInfo = train.status || `${train.arrivalTime}초 후`;
                        dongdaemunHtml += `
                            <div class="time-item">
                                <span><strong>${train.destination}</strong></span>
                                <span class="arrival-time">${arrivalInfo}</span>
                            </div>
                        `;
                    });
                    dongdaemunDiv.innerHTML = dongdaemunHtml;
                } else {
                    dongdaemunDiv.innerHTML = '<div class="error">4호선 하행 열차 정보가 없습니다.</div>';
                }
                
                dongdaemunUpdateDiv.textContent = `마지막 업데이트: ${currentTime}`;
                
            } catch (error) {
                console.error('동대문역사문화공원역 API 오류:', error);
                if (dongdaemunDiv.innerHTML.includes('loading')) {
                    dongdaemunDiv.innerHTML = '<div class="error">지하철 정보를 불러올 수 없습니다.</div>';
                }
            }
        }
        
        // 공항철도 시간표 가져오기
        function getArexSchedule() {
            const airportDiv = document.getElementById('airport-schedule');
            const seoulDiv = document.getElementById('seoul-schedule');
            const airportUpdateDiv = document.getElementById('airport-update');
            const seoulUpdateDiv = document.getElementById('seoul-update');
            
            // 첫 로딩이 아닌 경우 기존 데이터 유지
            if (airportDiv.innerHTML.includes('loading')) {
                airportDiv.innerHTML = '<div class="loading">시간표를 불러오는 중...</div>';
                seoulDiv.innerHTML = '<div class="loading">시간표를 불러오는 중...</div>';
            }
            
            setTimeout(() => {
                const currentTime = new Date().toLocaleTimeString();
                
                // 인천공항 방향 시간표
                const airportSchedules = generateSchedule('airport');
                let airportHtml = '';
                airportSchedules.forEach(schedule => {
                    airportHtml += `
                        <div class="time-item">
                            <span><strong>${schedule.time}</strong> → ${schedule.destination}</span>
                            <span class="arrival-time">${schedule.remaining}</span>
                        </div>
                    `;
                });
                airportDiv.innerHTML = airportHtml;
                airportUpdateDiv.textContent = `마지막 업데이트: ${currentTime}`;
                
                // 서울역 방향 시간표 (청라 방향)
                const seoulSchedules = generateSchedule('seoul');
                let seoulHtml = '';
                seoulSchedules.forEach(schedule => {
                    seoulHtml += `
                        <div class="time-item">
                            <span><strong>${schedule.time}</strong> → ${schedule.destination}</span>
                            <span class="arrival-time">${schedule.remaining}</span>
                        </div>
                    `;
                });
                seoulDiv.innerHTML = seoulHtml;
                seoulUpdateDiv.textContent = `마지막 업데이트: ${currentTime}`;
                
            }, 800);
        }
        
        // 페이지 로드 시 자동 실행
        window.onload = function() {
            updateCurrentTime();
            generateArexSchedule();
            getStationInfo();
            
            // 1초마다 시간 업데이트
            setInterval(updateCurrentTime, 1000);
            
            // 1분마다 공항철도 시간표 업데이트
            setInterval(generateArexSchedule, 60000);
            
            // 5초마다 출퇴근 시작역 정보만 업데이트
            setInterval(getStationInfo, 5000);
        };
    </script>
</body>
</html>
