<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µí•­ì² ë„ ì •ë³´</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">â† ë’¤ë¡œ</a>
        <h1>ğŸš„ ê³µí•­ì² ë„</h1>
        
        <!-- ì¶œí‡´ê·¼ ì‹œì‘ì—­ ì‹¤ì‹œê°„ ì •ë³´ -->
        <div class="time-table">
            <h3>ğŸš‡ ì¶œí‡´ê·¼ ì§€í•˜ì²  ì‹¤ì‹œê°„ ì •ë³´</h3>
            
            <div class="direction-section">
                <h4>ğŸŒ… ì²­ë¼êµ­ì œë„ì‹œì—­ (ì¶œê·¼ì‹œ) - ê³µí•­ì² ë„</h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">ì„œìš¸í–‰</p>
                <div id="cheongna-info">
                    <div class="loading">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
                <p id="cheongna-update" style="font-size: 11px; color: #999; text-align: right; margin-top: 5px;"></p>
            </div>
            
            <div class="direction-section">
                <h4>ğŸŒ† ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›ì—­ (í‡´ê·¼ì‹œ) - 4í˜¸ì„  í•˜í–‰</h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">ì˜¤ì´ë„í–‰, ì‚¬ë‹¹í–‰</p>
                <div id="dongdaemun-info">
                    <div class="loading">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
                <p id="dongdaemun-update" style="font-size: 11px; color: #999; text-align: right; margin-top: 5px;"></p>
            </div>
            
            <button class="refresh-btn" onclick="getStationInfo()">ìƒˆë¡œê³ ì¹¨</button>
        </div>
        
        <!-- ì„œìš¸ì—­ ê³µí•­ì² ë„ ì‹œê°„í‘œ -->
        <div class="time-table">
            <h3>ğŸš‰ ì„œìš¸ì—­ ê³µí•­ì² ë„ ì‹œê°„í‘œ</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">í˜„ì¬ ì‹œê°„: <span id="current-time"></span></p>
            
            <div class="direction-section">
                <h4>ğŸ›« ì„œìš¸ì—­ ì¶œë°œ â†’ ì¸ì²œê³µí•­ ë°©í–¥</h4>
                <div id="seoul-departure-schedule">
                    <!-- í˜„ì¬ ì‹œê°„ ì´í›„ ì‹œê°„í‘œê°€ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
                <p style="font-size: 11px; color: #999; text-align: center; margin-top: 10px;">
                    ì§í†µ: 43ë¶„ ì†Œìš” | ì¼ë°˜: 56ë¶„ ì†Œìš”<br>
                    6-9ì‹œ: 10ë¶„ ê°„ê²©, í‰ì‹œ: 15-20ë¶„ ê°„ê²©
                </p>
            </div>
        </div>
    </div>
    
    <script>
        // í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-time').textContent = timeString;
        }
        
        // í˜„ì¬ ì‹œê°„ ì´í›„ ê³µí•­ì² ë„ ì‹œê°„í‘œ ìƒì„±
        function generateArexSchedule() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // ê³µí•­ì² ë„ ì‹œê°„í‘œ (ëŒ€ëµì ì¸ ìš´í–‰ ì‹œê°„)
            const baseSchedule = [
                { time: '05:20', type: 'ì§í†µ' }, { time: '05:53', type: 'ì¼ë°˜' },
                { time: '06:00', type: 'ì§í†µ' }, { time: '06:13', type: 'ì¼ë°˜' },
                { time: '06:20', type: 'ì§í†µ' }, { time: '06:33', type: 'ì¼ë°˜' },
                { time: '06:40', type: 'ì§í†µ' }, { time: '06:53', type: 'ì¼ë°˜' },
                { time: '07:00', type: 'ì§í†µ' }, { time: '07:13', type: 'ì¼ë°˜' },
                { time: '07:20', type: 'ì§í†µ' }, { time: '07:33', type: 'ì¼ë°˜' },
                { time: '07:40', type: 'ì§í†µ' }, { time: '07:53', type: 'ì¼ë°˜' },
                { time: '08:00', type: 'ì§í†µ' }, { time: '08:13', type: 'ì¼ë°˜' },
                { time: '08:20', type: 'ì§í†µ' }, { time: '08:33', type: 'ì¼ë°˜' },
                { time: '08:40', type: 'ì§í†µ' }, { time: '08:53', type: 'ì¼ë°˜' },
                { time: '09:00', type: 'ì§í†µ' }, { time: '09:20', type: 'ì§í†µ' },
                { time: '09:40', type: 'ì§í†µ' }, { time: '10:00', type: 'ì§í†µ' },
                { time: '10:20', type: 'ì§í†µ' }, { time: '10:40', type: 'ì§í†µ' },
                { time: '11:00', type: 'ì§í†µ' }, { time: '11:20', type: 'ì§í†µ' },
                { time: '11:40', type: 'ì§í†µ' }, { time: '12:00', type: 'ì§í†µ' },
                { time: '12:20', type: 'ì§í†µ' }, { time: '12:40', type: 'ì§í†µ' },
                { time: '13:00', type: 'ì§í†µ' }, { time: '13:20', type: 'ì§í†µ' },
                { time: '13:40', type: 'ì§í†µ' }, { time: '14:00', type: 'ì§í†µ' },
                { time: '14:20', type: 'ì§í†µ' }, { time: '14:40', type: 'ì§í†µ' },
                { time: '15:00', type: 'ì§í†µ' }, { time: '15:20', type: 'ì§í†µ' },
                { time: '15:40', type: 'ì§í†µ' }, { time: '16:00', type: 'ì§í†µ' },
                { time: '16:20', type: 'ì§í†µ' }, { time: '16:40', type: 'ì§í†µ' },
                { time: '17:00', type: 'ì§í†µ' }, { time: '17:20', type: 'ì§í†µ' },
                { time: '17:40', type: 'ì§í†µ' }, { time: '18:00', type: 'ì§í†µ' },
                { time: '18:20', type: 'ì§í†µ' }, { time: '18:40', type: 'ì§í†µ' },
                { time: '19:00', type: 'ì§í†µ' }, { time: '19:20', type: 'ì§í†µ' },
                { time: '19:40', type: 'ì§í†µ' }, { time: '20:00', type: 'ì§í†µ' },
                { time: '20:20', type: 'ì§í†µ' }, { time: '20:40', type: 'ì§í†µ' },
                { time: '21:00', type: 'ì§í†µ' }, { time: '21:20', type: 'ì§í†µ' },
                { time: '21:40', type: 'ì§í†µ' }, { time: '22:00', type: 'ì§í†µ' },
                { time: '22:20', type: 'ì§í†µ' }, { time: '22:40', type: 'ì§í†µ' },
                { time: '23:00', type: 'ì§í†µ' }, { time: '23:20', type: 'ì§í†µ' },
                { time: '23:48', type: 'ì§í†µ' }
            ];
            
            // í˜„ì¬ ì‹œê°„ ì´í›„ ì‹œê°„í‘œë§Œ í•„í„°ë§
            const futureSchedule = baseSchedule.filter(item => {
                const [hour, minute] = item.time.split(':').map(Number);
                return hour > currentHour || (hour === currentHour && minute > currentMinute);
            }).slice(0, 10); // ë‹¤ìŒ 10ê°œë§Œ í‘œì‹œ
            
            const scheduleDiv = document.getElementById('seoul-departure-schedule');
            let html = '';
            
            futureSchedule.forEach(item => {
                html += `
                    <div class="time-item">
                        <span><strong>${item.time}</strong> â†’ ì¸ì²œê³µí•­</span>
                        <span>${item.type}</span>
                    </div>
                `;
            });
            
            if (futureSchedule.length === 0) {
                html = '<div class="error">ì˜¤ëŠ˜ ìš´í–‰ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
            }
            
            scheduleDiv.innerHTML = html;
        }
        
        // ê³µí•­ì² ë„ ì‹œê°„í‘œ ìƒì„± (í–‰ì„ ì§€ í¬í•¨)
        function generateSchedule(direction) {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            let schedules = [];
            
            // 6ì‹œë¶€í„° 23ì‹œê¹Œì§€ ìš´í–‰
            for (let hour = Math.max(6, currentHour); hour <= 23; hour++) {
                const intervals = [5, 15, 25, 35, 45, 55];
                
                intervals.forEach(minute => {
                    if (hour === currentHour && minute <= currentMinute) {
                        return;
                    }
                    
                    const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const remainingMinutes = (hour - currentHour) * 60 + (minute - currentMinute);
                    
                    if (schedules.length < 6) {
                        // í–‰ì„ ì§€ ëœë¤ ì„ íƒ
                        const destinations = direction === 'airport' 
                            ? ['ê²€ì•”', 'ì¸ì²œê³µí•­'] 
                            : ['ì„œìš¸ì—­', 'ì²­ë¼êµ­ì œë„ì‹œ'];
                        const destination = destinations[Math.floor(Math.random() * destinations.length)];
                        
                        schedules.push({
                            time: timeStr,
                            remaining: remainingMinutes > 0 ? `${remainingMinutes}ë¶„ í›„` : 'ê³§ ì¶œë°œ',
                            destination: destination
                        });
                    }
                });
            }
            
            return schedules;
        }
        
        // ì¶œí‡´ê·¼ ì‹œì‘ì—­ ì‹¤ì‹œê°„ ì •ë³´
        async function getStationInfo() {
            const cheongnaDiv = document.getElementById('cheongna-info');
            const dongdaemunDiv = document.getElementById('dongdaemun-info');
            const cheongnaUpdateDiv = document.getElementById('cheongna-update');
            const dongdaemunUpdateDiv = document.getElementById('dongdaemun-update');
            
            // ì²« ë¡œë”©ì´ ì•„ë‹Œ ê²½ìš° ê¸°ì¡´ ë°ì´í„° ìœ ì§€
            if (cheongnaDiv.innerHTML.includes('loading')) {
                cheongnaDiv.innerHTML = '<div class="loading">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            }
            if (dongdaemunDiv.innerHTML.includes('loading')) {
                dongdaemunDiv.innerHTML = '<div class="loading">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            }
            
            const currentTime = new Date().toLocaleTimeString();
            
            // ì²­ë¼êµ­ì œë„ì‹œì—­ ì‹¤ì œ ì§€í•˜ì²  ì •ë³´ (ì„œìš¸í–‰ë§Œ)
            try {
                const cheongnaResponse = await fetch('/api/subway?station=ì²­ë¼êµ­ì œë„ì‹œ');
                const cheongnaResult = await cheongnaResponse.json();
                
                console.log('ì²­ë¼êµ­ì œë„ì‹œì—­ API ì‘ë‹µ:', cheongnaResult);
                
                if (cheongnaResult.success && cheongnaResult.trains && cheongnaResult.trains.length > 0) {
                    let cheongnaHtml = '';
                    cheongnaResult.trains.forEach(train => {
                        const arrivalInfo = train.status || `${train.arrivalTime}ì´ˆ í›„`;
                        cheongnaHtml += `
                            <div class="time-item">
                                <span><strong>ê³µí•­ì² ë„</strong> â†’ ${train.destination}</span>
                                <span class="arrival-time">${arrivalInfo}</span>
                            </div>
                        `;
                    });
                    cheongnaDiv.innerHTML = cheongnaHtml;
                } else {
                    cheongnaDiv.innerHTML = '<div class="error">ì„œìš¸í–‰ ì—´ì°¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
                
                cheongnaUpdateDiv.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${currentTime}`;
                
            } catch (error) {
                console.error('ì²­ë¼êµ­ì œë„ì‹œì—­ API ì˜¤ë¥˜:', error);
                if (cheongnaDiv.innerHTML.includes('loading')) {
                    cheongnaDiv.innerHTML = '<div class="error">ì§€í•˜ì²  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            }
            
            // ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›ì—­ ì‹¤ì œ ì§€í•˜ì²  ì •ë³´ (4í˜¸ì„  í•˜í–‰ì„ ë§Œ)
            try {
                const dongdaemunResponse = await fetch('/api/subway?station=ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›');
                const dongdaemunResult = await dongdaemunResponse.json();
                
                console.log('ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›ì—­ API ì‘ë‹µ:', dongdaemunResult);
                
                if (dongdaemunResult.success && dongdaemunResult.trains && dongdaemunResult.trains.length > 0) {
                    let dongdaemunHtml = '';
                    dongdaemunResult.trains.forEach(train => {
                        const arrivalInfo = train.status || `${train.arrivalTime}ì´ˆ í›„`;
                        dongdaemunHtml += `
                            <div class="time-item">
                                <span><strong>${train.destination}</strong></span>
                                <span class="arrival-time">${arrivalInfo}</span>
                            </div>
                        `;
                    });
                    dongdaemunDiv.innerHTML = dongdaemunHtml;
                } else {
                    dongdaemunDiv.innerHTML = '<div class="error">4í˜¸ì„  í•˜í–‰ ì—´ì°¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
                
                dongdaemunUpdateDiv.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${currentTime}`;
                
            } catch (error) {
                console.error('ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›ì—­ API ì˜¤ë¥˜:', error);
                if (dongdaemunDiv.innerHTML.includes('loading')) {
                    dongdaemunDiv.innerHTML = '<div class="error">ì§€í•˜ì²  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            }
        }
        
        // ê³µí•­ì² ë„ ì‹œê°„í‘œ ê°€ì ¸ì˜¤ê¸°
        function getArexSchedule() {
            const airportDiv = document.getElementById('airport-schedule');
            const seoulDiv = document.getElementById('seoul-schedule');
            const airportUpdateDiv = document.getElementById('airport-update');
            const seoulUpdateDiv = document.getElementById('seoul-update');
            
            // ì²« ë¡œë”©ì´ ì•„ë‹Œ ê²½ìš° ê¸°ì¡´ ë°ì´í„° ìœ ì§€
            if (airportDiv.innerHTML.includes('loading')) {
                airportDiv.innerHTML = '<div class="loading">ì‹œê°„í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                seoulDiv.innerHTML = '<div class="loading">ì‹œê°„í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            }
            
            setTimeout(() => {
                const currentTime = new Date().toLocaleTimeString();
                
                // ì¸ì²œê³µí•­ ë°©í–¥ ì‹œê°„í‘œ
                const airportSchedules = generateSchedule('airport');
                let airportHtml = '';
                airportSchedules.forEach(schedule => {
                    airportHtml += `
                        <div class="time-item">
                            <span><strong>${schedule.time}</strong> â†’ ${schedule.destination}</span>
                            <span class="arrival-time">${schedule.remaining}</span>
                        </div>
                    `;
                });
                airportDiv.innerHTML = airportHtml;
                airportUpdateDiv.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${currentTime}`;
                
                // ì„œìš¸ì—­ ë°©í–¥ ì‹œê°„í‘œ (ì²­ë¼ ë°©í–¥)
                const seoulSchedules = generateSchedule('seoul');
                let seoulHtml = '';
                seoulSchedules.forEach(schedule => {
                    seoulHtml += `
                        <div class="time-item">
                            <span><strong>${schedule.time}</strong> â†’ ${schedule.destination}</span>
                            <span class="arrival-time">${schedule.remaining}</span>
                        </div>
                    `;
                });
                seoulDiv.innerHTML = seoulHtml;
                seoulUpdateDiv.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${currentTime}`;
                
            }, 800);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.onload = function() {
            updateCurrentTime();
            generateArexSchedule();
            getStationInfo();
            
            // 1ì´ˆë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
            setInterval(updateCurrentTime, 1000);
            
            // 1ë¶„ë§ˆë‹¤ ê³µí•­ì² ë„ ì‹œê°„í‘œ ì—…ë°ì´íŠ¸
            setInterval(generateArexSchedule, 60000);
            
            // 5ì´ˆë§ˆë‹¤ ì¶œí‡´ê·¼ ì‹œì‘ì—­ ì •ë³´ë§Œ ì—…ë°ì´íŠ¸
            setInterval(getStationInfo, 5000);
        };
    </script>
</body>
</html>
