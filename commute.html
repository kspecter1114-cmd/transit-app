<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶œí‡´ê·¼ ì •ë³´</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">â† ë’¤ë¡œ</a>
        <h1>ğŸš— ì¶œí‡´ê·¼ ì •ë³´</h1>
        
        <!-- ì¶œê·¼ ì •ë³´ -->
        <div class="time-table">
            <h3>ğŸŒ… ì¶œê·¼ - ì •ë¥˜ì¥ 89295</h3>
            <p id="morning-station" style="color: #666; font-size: 14px; margin-bottom: 15px;">ì •ë¥˜ì¥ëª…: ì²­ë¼ì„¼í…€ë¡œì œë¹„ì•™</p>
            <div id="morning-info">
                <div class="loading">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
            <p id="morning-update" style="font-size: 11px; color: #999; text-align: right; margin-top: 10px;"></p>
            <button class="refresh-btn" onclick="getMorningBus()">ìƒˆë¡œê³ ì¹¨</button>
        </div>
        
        <!-- í‡´ê·¼ ì •ë³´ -->
        <div class="time-table">
            <h3>ğŸŒ† í‡´ê·¼ - ì •ë¥˜ì¥ 89215</h3>
            <p id="evening-station" style="color: #666; font-size: 14px; margin-bottom: 15px;">ì •ë¥˜ì¥ëª…: ì²­ë¼êµ­ì œë„ì‹œì—­(ì²­ë¼êµ­ì œêµë°©í–¥)</p>
            <div id="evening-info">
                <div class="loading">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
            <p id="evening-update" style="font-size: 11px; color: #999; text-align: right; margin-top: 10px;"></p>
            <button class="refresh-btn" onclick="getEveningBus()">ìƒˆë¡œê³ ì¹¨</button>
        </div>
    </div>
    
    <script>
        // ì •ë¥˜ì¥ëª… ê°€ì ¸ì˜¤ê¸°
        async function getStationName(stationId, elementId) {
            try {
                const response = await fetch(`/api/station?stationId=${stationId}`);
                const result = await response.json();
                
                if (result.success) {
                    document.querySelector(`#${elementId}`).textContent = `ì •ë¥˜ì¥ëª…: ${result.stationName}`;
                }
            } catch (error) {
                console.log('ì •ë¥˜ì¥ëª… ì¡°íšŒ ì‹¤íŒ¨');
            }
        }
        
        // ì¶œê·¼ ë²„ìŠ¤ ì •ë³´ (89295 - ì²­ë¼ì„¼í…€ë¡œì œë¹„ì•™)
        async function getMorningBus() {
            const infoDiv = document.getElementById('morning-info');
            const updateDiv = document.getElementById('morning-update');
            
            // ì²« ë¡œë”©ì´ ì•„ë‹Œ ê²½ìš° ê¸°ì¡´ ë°ì´í„° ìœ ì§€
            if (!infoDiv.innerHTML.includes('loading')) {
                // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒˆë¡œê³ ì¹¨
            } else {
                infoDiv.innerHTML = '<div class="loading">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            }
            
            try {
                // í‹°ë§µ API ì‹œë„
                const response = await fetch('/api/tmap-bus?stationId=89295');
                const result = await response.json();
                const currentTime = new Date().toLocaleTimeString();
                
                if (result.success && result.data.length > 0) {
                    // ì‹¤ì œ API ë°ì´í„°ì—ì„œ 2-1, 43, ê¸‰í–‰91ë²ˆë§Œ í•„í„°ë§
                    const targetBuses = ['2-1', '43', 'ê¸‰í–‰91'];
                    const filteredBuses = result.data.filter(bus => 
                        targetBuses.some(target => bus.routeNo?.includes(target))
                    );
                    
                    if (filteredBuses.length > 0) {
                        let html = '';
                        filteredBuses.forEach(bus => {
                            const arrivalTime = bus.predictTime1 || 'ì •ë³´ì—†ìŒ';
                            html += `
                                <div class="time-item">
                                    <span><strong>${bus.routeNo}ë²ˆ</strong></span>
                                    <span class="arrival-time">${arrivalTime}ë¶„ í›„</span>
                                </div>
                            `;
                        });
                        infoDiv.innerHTML = html;
                        updateDiv.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${currentTime} (í‹°ë§µ)`;
                        return;
                    }
                }
                
                // API ì‹¤íŒ¨ ë˜ëŠ” ë°ì´í„° ì—†ì„ ë•Œ
                if (infoDiv.innerHTML.includes('loading')) {
                    infoDiv.innerHTML = '<div class="error">ë²„ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
                updateDiv.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${currentTime}`;
                
            } catch (error) {
                console.error('ë²„ìŠ¤ API ì˜¤ë¥˜:', error);
                if (infoDiv.innerHTML.includes('loading')) {
                    infoDiv.innerHTML = '<div class="error">ë²„ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            }
        }
        
        // í‡´ê·¼ ë²„ìŠ¤ ì •ë³´ (89215 - ì²­ë¼êµ­ì œë„ì‹œì—­)
        async function getEveningBus() {
            const infoDiv = document.getElementById('evening-info');
            const updateDiv = document.getElementById('evening-update');
            
            // ì²« ë¡œë”©ì´ ì•„ë‹Œ ê²½ìš° ê¸°ì¡´ ë°ì´í„° ìœ ì§€
            if (!infoDiv.innerHTML.includes('loading')) {
                // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒˆë¡œê³ ì¹¨
            } else {
                infoDiv.innerHTML = '<div class="loading">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            }
            
            try {
                // í‹°ë§µ API ì‹œë„
                const response = await fetch('/api/tmap-bus?stationId=89215');
                const result = await response.json();
                const currentTime = new Date().toLocaleTimeString();
                
                if (result.success && result.data.length > 0) {
                    // ì‹¤ì œ API ë°ì´í„°ì—ì„œ 2-1, 43, 72, 202, ê¸‰í–‰91ë²ˆë§Œ í•„í„°ë§
                    const targetBuses = ['2-1', '43', '72', '202', 'ê¸‰í–‰91'];
                    const filteredBuses = result.data.filter(bus => 
                        targetBuses.some(target => bus.routeNo?.includes(target))
                    );
                    
                    if (filteredBuses.length > 0) {
                        let html = '';
                        filteredBuses.forEach(bus => {
                            const arrivalTime = bus.predictTime1 || 'ì •ë³´ì—†ìŒ';
                            html += `
                                <div class="time-item">
                                    <span><strong>${bus.routeNo}ë²ˆ</strong></span>
                                    <span class="arrival-time">${arrivalTime}ë¶„ í›„</span>
                                </div>
                            `;
                        });
                        infoDiv.innerHTML = html;
                        updateDiv.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${currentTime} (í‹°ë§µ)`;
                        return;
                    }
                }
                
                // API ì‹¤íŒ¨ ë˜ëŠ” ë°ì´í„° ì—†ì„ ë•Œ
                if (infoDiv.innerHTML.includes('loading')) {
                    infoDiv.innerHTML = '<div class="error">ë²„ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
                updateDiv.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${currentTime}`;
                
            } catch (error) {
                console.error('ë²„ìŠ¤ API ì˜¤ë¥˜:', error);
                if (infoDiv.innerHTML.includes('loading')) {
                    infoDiv.innerHTML = '<div class="error">ë²„ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.onload = function() {
            // ì •ë¥˜ì¥ëª… ê°€ì ¸ì˜¤ê¸°
            getStationName('89295', 'morning-station');
            getStationName('89215', 'evening-station');
            
            getMorningBus();
            getEveningBus();
            
            // 5ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
            setInterval(() => {
                getMorningBus();
                getEveningBus();
            }, 5000);
        };
    </script>
</body>
</html>
